

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Combined fitting &mdash; SPARTAN 0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Templates" href="templates.html" />
    <link rel="prev" title="Spectroscopic fitting" href="spectroscopy.html" />
    <link href="_static/my_theme.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SPARTAN
          

          
            
            <img src="_static/transparent.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="TUI.html">Configuration of a fitting run</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUI.html">Graphical User interface: Visualizing results</a></li>
<li class="toctree-l1"><a class="reference internal" href="photometry.html">Photometric fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="spectroscopy.html">Spectroscopic fitting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Combined fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data-configuration-and-compilation">Data-Configuration and compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fitting-procedure-generalities">Fitting procedure: generalities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-initialization">The Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-main-function">The main function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-result-module">The result module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-template-normalization">Data/Template Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#results-final-catalog-production-and-gui-vizualization">Results: Final catalog production and GUI vizualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="Conferences.html">Conferences and Papers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SPARTAN</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Combined fitting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/combined.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p id="combined"><a class="reference external" href="https://www.python.org/downloads/release/python-360/"><img alt="python" src="https://img.shields.io/badge/Made%20with-Python-1f425f.svg" /></a> <img alt="Python36" src="https://img.shields.io/badge/python-3.6-blue.svg" /> <a class="reference external" href="http://perso.crans.org/besson/LICENSE.html"><img alt="Licence" src="https://img.shields.io/badge/License-GPLv3-blue.svg" /></a>
<a class="reference external" href="https://matplotlib.org/"><img alt="matplotlib" src="https://img.shields.io/badge/poweredby-matplotlib-orange.svg" /></a> <a class="reference external" href="https://pypi.python.org/pypi/PyQt5"><img alt="PyQt5" src="https://img.shields.io/badge/poweredby-PyQt5-orange.svg" /></a> <a class="reference external" href="http://www.numpy.org/"><img alt="numpy" src="https://img.shields.io/badge/poweredby-numpy-orange.svg" /></a> <a class="reference external" href="https://www.scipy.org/"><img alt="scipy" src="https://img.shields.io/badge/poweredby-scipy-orange.svg" /></a></p>
<div class="section" id="combined-fitting">
<h1>Combined fitting<a class="headerlink" href="#combined-fitting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="data-configuration-and-compilation">
<h2>Data-Configuration and compilation<a class="headerlink" href="#data-configuration-and-compilation" title="Permalink to this headline">¶</a></h2>
<p>As for the other types of fitting you must give SPARTAN an input catalog, in ascii format (simple text file). When SPARTAN opens it, it will read the header. Whatever you want to fit, the header of the catalog must start with two columns: ID and redshift with an hash(#) at the beginning of the line. THIS IS MANDATORY:</p>
<p class="centered">
<strong>#ident     redshift</strong></p><p>For the combined fitting, the rest of the catalog starts with the spectroscopic information and only then we will add the photometry. So it is basically joining the configuration of spectrosopy (please see <a class="reference internal" href="spectroscopy.html"><span class="doc">Spectroscopic fitting</span></a>) and photometry (please see <a class="reference internal" href="photometry.html"><span class="doc">Photometric fitting</span></a>). For example, if you want to fit 2 spectra with and 5 magnitude you will have a catalog that looks like this:</p>
<p class="centered">
<strong>#ident     redshift  spec1  mag_spec1 mag_spec1_err spec2 mag_spec2 mag_spec2_err    mag1  mag1_err   mag2    mag2_err  mag3    mag3_err  mag4  mag4_err mag5 mag5_err</strong></p><p>Each spectrum must be a text file with 3 columns (lambda, flux, error) and the name of each spectrum must finish by the extension <strong>.spec</strong>.</p>
<p>During the preparation of the data, each spectrum will be normalized to its own magnitude.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>It is important to note that when fitting multiple spectra for a given object, these spectra must not overlap.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>A good tip to combined data is to give a normalization magnitude to the spectra that is also one of the photometric part of the data.</p>
</div>
<p>You can find an example of such file here <a class="reference download internal" download="" href="_downloads/506d8ab115db70dfd0a7a93460ce515d/Example_combined.txt"><code class="xref download docutils literal notranslate"><span class="pre">Combined</span> <span class="pre">input</span> <span class="pre">catalog</span></code></a></p>
</div>
<div class="section" id="fitting-procedure-generalities">
<h2>Fitting procedure: generalities<a class="headerlink" href="#fitting-procedure-generalities" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/Fit_combined.png"><img alt="_images/Fit_combined.png" src="_images/Fit_combined.png" style="width: 750px;" /></a>
</div>
<p>The flow chart shows the detailed procedure of the fit for a sample of photometrty and spectroscopy. It is composed of 3 parts:</p>
<ul class="simple">
<li><p>The initialization of the run where we load the library and the sample to fit.</p></li>
<li><p>The main loop. Where are actually making the fit</p></li>
<li><p>The results module where we save the results of a fit and where the final catalog of parameter is created</p></li>
</ul>
<p>We describe in detail each parts below in the following paragraphs.</p>
<div class="section" id="the-initialization">
<h3>The Initialization<a class="headerlink" href="#the-initialization" title="Permalink to this headline">¶</a></h3>
<p>Here SPARTAN loads the library that was computed from the configuration of the user. It loads both the table of parameters (and their names) and the table of templates. Everything is loaded from the .hdf5 library file.
Then the code takes the _dat.hdf5 file that was created from the configuration and the catalog of data that was given. He will make a quick loop over the full sample to check if some objects were already fitted. If so they will be skipped (unless the user allow the overfit, c.f. configuration above and TUI.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This first check is important. It means you can stop a fitting run at any moment and start it again from where you stopped, without needing to start all the run over from the beginning.</p>
</div>
<p>From the left over objects to plot, SPARTAN will take the firsts Ncpu (see <a class="reference internal" href="TUI.html"><span class="doc">Configuration of a fitting run</span></a>) object in the list and will send them to the fitting function. Each object will be fitted in parallel and Ncpu will be used.</p>
</div>
<div class="section" id="the-main-function">
<h3>The main function<a class="headerlink" href="#the-main-function" title="Permalink to this headline">¶</a></h3>
<p>For the combined fit the main function is a mainly a combination of both photometric and spectroscopic fitting process and the reader is refered to the corresponding page (<a class="reference internal" href="photometry.html"><span class="doc">Photometric fitting</span></a> and <a class="reference internal" href="spectroscopy.html"><span class="doc">Spectroscopic fitting</span></a>). The two <em>combined fitting</em> specific step are:</p>
<ul class="simple">
<li><p><strong>The choice of the data to fit</strong>: As shown in the <a class="reference internal" href="TUI.html"><span class="doc">Configuration of a fitting run</span></a> page, the user has the choice of fitting the full set of data of only the complementary ones. If you choose the <em>full</em> option then all spectroscopic and photometric data will be used. On the contrary, if you use the <em>complementary</em> option, SPARTAN will retain, the for fitting, only the complementary part. This means that when some data are overlapping SPARTAN will discard some of them, giving priority to the spectroscopy.</p></li>
<li><p><strong>The way we fit combined data</strong>: As described in the paper presenting SPARTAN, we use a direct approach to fit combined data. Once the preparation of the data is done, we compute the chi2 on both photometry and spectroscopy at once. Which means we do not give any extra weight to the spectroscopy or to the photometry.</p></li>
</ul>
</div>
<div class="section" id="the-result-module">
<h3>The result module<a class="headerlink" href="#the-result-module" title="Permalink to this headline">¶</a></h3>
<p>From the library of chi2, SPARTAN computes the PDF and the CDF for each parameter (see statistic). This will give access to the parameter measurements and their errors. If the user ask for it, the parameters from the best fit template (therefore without error) can be saved as well (see below). Aditionnaly, SPARTAN saves the best fit template (both original and resampled templates).</p>
</div>
</div>
<div class="section" id="data-template-normalization">
<h2>Data/Template Normalization<a class="headerlink" href="#data-template-normalization" title="Permalink to this headline">¶</a></h2>
<p>As the process is the same as for separated fit for photometry and spectroscopy we refer the user to the photometric and spectroscopic pages for this normalization.</p>
</div>
<div class="section" id="results-final-catalog-production-and-gui-vizualization">
<h2>Results: Final catalog production and GUI vizualization<a class="headerlink" href="#results-final-catalog-production-and-gui-vizualization" title="Permalink to this headline">¶</a></h2>
<p>At the end of the fitting run, SPARTAN creates automatically the final catalog. Depending on what you asked for, it will contain:</p>
<ul class="simple">
<li><p>The ID, redshift and number of points used during the fitting run</p></li>
<li><p>The PDF parameters (measurement and errors, ex: PDF_SFR, m1s_SFR, p1s_SFR)</p></li>
<li><p>The Parameters from the best fit template (no errors in this case, ex: BF_SFR)</p></li>
<li><p>The best fit template and best fit magnitudes are also saved.</p></li>
</ul>
<p>After the fit you can also load the result file into the SPARTAN GUI. This will allow you to visualize the individual fits (see below). It can also show you the global result of your sample. Go to the <a class="reference internal" href="GUI.html"><span class="doc">Graphical User interface: Visualizing results</span></a> GUI documentation for more information.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="templates.html" class="btn btn-neutral float-right" title="Templates" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spectroscopy.html" class="btn btn-neutral float-left" title="Spectroscopic fitting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, R. THOMAS

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>