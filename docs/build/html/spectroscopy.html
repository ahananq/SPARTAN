

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Spectroscopy &mdash; SPARTAN 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Conferences" href="Conferences.html" />
    <link rel="prev" title="Getting started" href="usage.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> SPARTAN
          

          
            
            <img src="_static/transparent.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Spectroscopy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration-data-files">Configuration: Data Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#associated-photometry">Associated photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="#final-spectroscopic-catalog-for-fitting-run">Final spectroscopic catalog for fitting run</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-spectroscopic-configuration">Configuration: spectroscopic configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-using-the-tui">A - Using the TUI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#b-editing-the-configuration-file-by-hand">B - Editing the configuration file by hand</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fitting-procedure">Fitting procedure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-initialization">The Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-main-function">The main function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-result-module">The result module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#results-final-catalog-production-and-gui-vizualization">Results: Final catalog production and GUI vizualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Conferences.html">Conferences</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SPARTAN</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Spectroscopy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/spectroscopy.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p id="spectroscopic"><a class="reference external" href="https://www.python.org/downloads/release/python-360/"><img alt="python" src="https://img.shields.io/badge/Made%20with-Python-1f425f.svg" /></a> <img alt="Python36" src="https://img.shields.io/badge/python-3.6-blue.svg" /> <a class="reference external" href="http://perso.crans.org/besson/LICENSE.html"><img alt="Licence" src="https://img.shields.io/badge/License-GPLv3-blue.svg" /></a>
<a class="reference external" href="https://matplotlib.org/"><img alt="matplotlib" src="https://img.shields.io/badge/poweredby-matplotlib-orange.svg" /></a> <a class="reference external" href="https://pypi.python.org/pypi/PyQt5"><img alt="PyQt5" src="https://img.shields.io/badge/poweredby-PyQt5-orange.svg" /></a> <a class="reference external" href="http://www.numpy.org/"><img alt="numpy" src="https://img.shields.io/badge/poweredby-numpy-orange.svg" /></a> <a class="reference external" href="https://www.scipy.org/"><img alt="scipy" src="https://img.shields.io/badge/poweredby-scipy-orange.svg" /></a></p>
<div class="section" id="spectroscopy">
<h1>Spectroscopy<a class="headerlink" href="#spectroscopy" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="configuration-data-files">
<h2>Configuration: Data Files<a class="headerlink" href="#configuration-data-files" title="Permalink to this headline">¶</a></h2>
<p>To run the fit of single or multi-λ spectroscopy you need to provide SPARTAN with a catalog of data containing all the necessary informations. The spectra that you provide to SPARTAN must be either in ascii or in fits file. If you choose the ascii format the spectra have to be in the following 3-column format:</p>
<p class="centered">
<strong>Wavelength - Flux - error</strong></p><p>The name of each spectrum must end with the ‘.spec’ extension, example: <strong>spectrum_1.spec</strong></p>
</div>
<div class="section" id="associated-photometry">
<h2>Associated photometry<a class="headerlink" href="#associated-photometry" title="Permalink to this headline">¶</a></h2>
<p>For each spectrum you need to associate a photometric band which will serve as flux calibration of the spectroscopy. Of course this band must be in the wavelength domain of the spectrum (the filter must be entirely in the wavelength domain). For example, using VIMOS data (3600Å to 9500Å) you can provide the r-band. During the preparation of the data SPARTAN will normalize each spectrum to that band. If you do not have any available band you can create a fake one.</p>
</div>
<div class="section" id="final-spectroscopic-catalog-for-fitting-run">
<h2>Final spectroscopic catalog for fitting run<a class="headerlink" href="#final-spectroscopic-catalog-for-fitting-run" title="Permalink to this headline">¶</a></h2>
<p>The catalog that you need to give to SPARTAN is a ascii file. When SPARTAN opens it, it will read the header. Whatever you want to fit the header of the catalog must start with two columns: ID and redshift with an hash(#) at the beginning of the line. THIS IS MANDATORY:</p>
<p class="centered">
<strong>#ident     redshift</strong></p><p>Then you must add the columns with the following rules:</p>
<ul class="simple">
<li>For single spectroscopy: When you just have one spectrum in ascii format you must add three columns after ‘#ident     redshift’. One for the spectrum name and two for the associated magnitude (measurement and error). Therefore you will have:</li>
</ul>
<p class="centered">
<strong>#ident     redshift  spec   mag    mag_err</strong></p><ul class="simple">
<li>For multi-spectroscopy:  When you want to fit multi-spectroscopy, you have to follow the same method and add as many 3 columns set as you have spectra. Therefore you will have (for three spectra):</li>
</ul>
<p class="centered">
<strong>#ident     redshift  spec1   mag1    mag1_err   spec2   mag2    mag2_err  spec3   mag3    mag3_err</strong></p></div>
<div class="section" id="configuration-spectroscopic-configuration">
<h2>Configuration: spectroscopic configuration<a class="headerlink" href="#configuration-spectroscopic-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-using-the-tui">
<h3>A - Using the TUI<a class="headerlink" href="#a-using-the-tui" title="Permalink to this headline">¶</a></h3>
<p>To start a fitting run you need to create a configuration that SPARTAN is able to read. The easiest way to do so is to start the Text-Based User Interface (or TUI). For a global presentation of the TUI you can go directly to the TUI page that will provide you with a detailed description. For the spectroscopic fitting you need to follow these steps in order to get a correct configuration:</p>
<p>From the welcome window of the TUI, you will go directly to general information (see image on the left).</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="21%" />
<col width="18%" />
<col width="18%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Header row, column 1
(header rows optional)</th>
<th class="head">Header 2</th>
<th class="head">Header 3</th>
<th class="head">Header 4</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>body row 1, column 1</td>
<td>column 2</td>
<td>column 3</td>
<td>column 4</td>
</tr>
<tr class="row-odd"><td>body row 2</td>
<td>…</td>
<td>…</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>From their you have to fill all the field. If you fit a single spectrum you have to say yes to ‘use spectroscopy’ and enter ‘1’ un Nspec. You have to leave photometry to no. If you fit more than one spectrum tune the number in Nspec accordingly.</p>
<p>After the general configuration of the run you have to go to the spectroscopic information.</p>
<p>From their you have to fill all the fields again:</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="21%" />
<col width="18%" />
<col width="18%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Header row, column 1
(header rows optional)</th>
<th class="head">Header 2</th>
<th class="head">Header 3</th>
<th class="head">Header 4</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>body row 1, column 1</td>
<td>column 2</td>
<td>column 3</td>
<td>column 4</td>
</tr>
<tr class="row-odd"><td>body row 2</td>
<td>…</td>
<td>…</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>First you have to give the absolute path of the directory where all the spectra are stored.
Then you</p>
</div>
<div class="section" id="b-editing-the-configuration-file-by-hand">
<h3>B - Editing the configuration file by hand<a class="headerlink" href="#b-editing-the-configuration-file-by-hand" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="fitting-procedure">
<h2>Fitting procedure<a class="headerlink" href="#fitting-procedure" title="Permalink to this headline">¶</a></h2>
<p>The flow chart on the left show the detailed procedure of the fit of a sample of  single spectra. It is composed of 3 parts:</p>
<ul class="simple">
<li>The initialization of the run where we load the library and the sample to fit.</li>
<li>The main loop. Where are actually making the fit</li>
<li>The results module where we save the results of  a fit</li>
</ul>
<p>We describe in detail each parts below in the following paragraphs.</p>
<div class="section" id="the-initialization">
<h3>The Initialization<a class="headerlink" href="#the-initialization" title="Permalink to this headline">¶</a></h3>
<p>Here SPARTAN load the library that was computed from the configuration of the user. It loads both the table of parameters (and their names) and the table of templates. Everything is loaded from the <a href="#id1"><span class="problematic" id="id2">*</span></a>.hdf5 library file.
Then the code takes the <a href="#id3"><span class="problematic" id="id4">*</span></a>dat.hdf5 that eas created from the configuration and the catalog of data that was given. He will make a quick loop over the full sample to check if some objects were already fitted. If so they will be skipped (unless the user allow the overfit, c.f. configuration above and TUI.)</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This first check is important. It means you can stop a fitting run at any moment and start it again from where you stopped, without needing to start all the run over from the beginning.</p>
</div>
<p>From the left over objects to plot, SPARTAN will take the firsts Ncpu (see TUI) object in the list and will send them to the fitting function. Each object will be fitted in parallel:</p>
</div>
<div class="section" id="the-main-function">
<h3>The main function<a class="headerlink" href="#the-main-function" title="Permalink to this headline">¶</a></h3>
<p>We describe here the main loop for a given object.
The main function start by checking again if  the object have to be fitted. If yes, SPARTAN extracts, from the <a href="#id5"><span class="problematic" id="id6">*</span></a>dat.hdf5 file, the spectroscopic informations of the object (wavelength, flux and error). Then it extracts the normalization informations (it can be magnitude or regions, see section 2 above). The redshift is also retrieved. If this redshift is negative SPARTAN will not perform the fitting. If the user asked for some regions to be skipped SPARTAN will do it at this moment (see section 2 above).</p>
<p>Then SPARTAN will adjust the library. It will start by checking if one of the line in the line file is present by performing a quick-and-dirty estimation of the EW on the spectrum itself (particularly usefull for lines that can be in absorption or in emission). If some of those lines are absent then it will create a list of absent line. After this pre-check SPARTAN will add the emission lines to the library, skipping the lines that are absents. Then SPARTAN will adjust the resolution of the templates (see resolution). Once this is done,  SPARTAN will apply the extinction: the Dust and IGM extinction (see Extinction) . At this point SPARTAN will check if some template have to be ignored. It is the case when templates ages are older than the age of the universe at the redshift we are fitting. The left over templates are then redshifted to the observed redshift and the templates wavelength grid is adjusted to the observed wavelength grid. This library is then used to compute the chi2.</p>
</div>
<div class="section" id="the-result-module">
<h3>The result module<a class="headerlink" href="#the-result-module" title="Permalink to this headline">¶</a></h3>
<p>From the library of chi2, SPARTAN computes the PDF and the CDF for each parameter (see statistic). This will give access to the parameter measurements and their errors. If the user ask for it, the parameters from the best fit template (therefore without error) can be saved as well (see below). Aditionnaly, SPARTAN saves the best fit template (both original and resampled templates).</p>
</div>
</div>
<div class="section" id="results-final-catalog-production-and-gui-vizualization">
<h2>Results: Final catalog production and GUI vizualization<a class="headerlink" href="#results-final-catalog-production-and-gui-vizualization" title="Permalink to this headline">¶</a></h2>
<p>At the end of the fitting run, SPARTAN creates automatically the final catalog. Depending on what you asked for, it will contain:</p>
<ul class="simple">
<li>The ID, redshift and number of points used during the fitting run</li>
<li>The PDF parameters (measurement and errors)</li>
<li>The Parameters from the best fit template (no errors in this case)</li>
</ul>
<p>An example is given here.</p>
<p>After the fit you can also load the result file (<a href="#id7"><span class="problematic" id="id8">*</span></a>_Res.hdf5) into the SPARTAN GUI. This will allow you to visualize the individual fits (see below). It can also show you the global result of your sample. Go to the GUI documentation for more information.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Conferences.html" class="btn btn-neutral float-right" title="Conferences" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="usage.html" class="btn btn-neutral" title="Getting started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, R. THOMAS.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>